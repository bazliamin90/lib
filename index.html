<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="header.js"></script>
  <title>Tadabbur</title>

  <!-- PDF.js base CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.css" />
  <link rel="stylesheet" href="_pdfstyle.css">
  <link rel="stylesheet" href="style.css">
  
</head>
<body>
  <!-- Controls -->
  <div id="controls">
    <header3-component></header3-component>
    <label>M/s:
      <input type="number" id="pageInput" value="1" min="1" style="width:4rem">
    </label>
    <span id="pageCount">/ ?</span>

    <label style="margin-left:1rem">Zoom:
      <select id="zoomSelect">
        <option value="0.5">50%</option>
        <option value="1" selected>100%</option>
        <option value="1.5">150%</option>
        <option value="2">200%</option>
        <option value="3">300%</option>
        <option value="page-width">Fit W</option>
      </select>
    </label>
  </div>

  <!-- PDF container -->
  <div id="viewerContainer">
    <div id="viewer" class="pdfViewer"></div>
  </div>

    <!-- PDF.js scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

    const container = document.getElementById("viewerContainer");
    const eventBus = new pdfjsViewer.EventBus();
    const linkService = new pdfjsViewer.PDFLinkService({ eventBus });
    const findController = new pdfjsViewer.PDFFindController({ eventBus, linkService });

    const viewer = new pdfjsViewer.PDFViewer({
      container,
      eventBus,
      linkService,
      findController,
      textLayerMode: 2,
    });
    linkService.setViewer(viewer);

    let pdfDoc = null;

    eventBus.on("pagesinit", () => {
  if (window.innerWidth < 768) {
    viewer.currentScaleValue = "page-width"; // phones/tablets
  } else {
    viewer.currentScaleValue = "auto";       // desktops
  }
  document.getElementById("pageCount").textContent = "/ " + pdfDoc.numPages;
  document.getElementById("pageInput").max = pdfDoc.numPages;
});

    eventBus.on("pagechanging", (e) => {
      document.getElementById("pageInput").value = e.pageNumber;
    });

    async function openPDF(url) {
      const loadingTask = pdfjsLib.getDocument(url);
      pdfDoc = await loadingTask.promise;
      viewer.setDocument(pdfDoc);
      linkService.setDocument(pdfDoc, null);
    }

    // Load local test.pdf
    openPDF("index.pdf");

    // Page jump via input
    document.getElementById("pageInput").addEventListener("change", (e) => {
      let page = parseInt(e.target.value, 10);
      if (page > 0 && page <= pdfDoc.numPages) {
        viewer.currentPageNumber = page;
      } else {
        e.target.value = viewer.currentPageNumber;
      }
    });

    // Zoom control
    document.getElementById("zoomSelect").addEventListener("change", (e) => {
      viewer.currentScaleValue = e.target.value;
    });
  </script>
</body>
</html>