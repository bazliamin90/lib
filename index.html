<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="header.js"></script>
  <title>Tadabbur Ad-Dhuha - An-Nas</title>

  <!-- PDF.js base CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.css" />
  <link rel="stylesheet" href="style.css" />
  
</head>
<body>
  <!-- Controls -->
  <div id="controls">
    <header3-component></header3-component>

    <button id="prevPage">◀</button>

    <label>
      <input type="number" id="pageInput" value="1" min="1" style="width:4rem">
    </label>
    <span id="pageCount">/--</span>

    <button id="nextPage">▶</button>

    <label style="margin-left:1rem">
      <select id="zoomSelect">
        <option value="0.5">50%</option>
        <option value="1">100%</option>
        <option value="1.5">150%</option>
        <option value="2">200%</option>
        <option value="3">300%</option>
        <option value="page-width">Fit W</option>
        <option value="page-height">Fit H</option>
      </select>
    </label>
  </div>

  <!-- PDF container -->
  <div id="viewerContainer">
    <div id="viewer" class="pdfViewer"></div>
  </div>

  <!-- PDF.js scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

    const container = document.getElementById("viewerContainer");
    const eventBus = new pdfjsViewer.EventBus();
    const linkService = new pdfjsViewer.PDFLinkService({ eventBus });
    const findController = new pdfjsViewer.PDFFindController({ eventBus, linkService });

    // Single Page Viewer
    const viewer = new pdfjsViewer.PDFSinglePageViewer({
      container,
      eventBus,
      linkService,
      findController,
      textLayerMode: 2,
    });
    linkService.setViewer(viewer);

    let pdfDoc = null;

    // When PDF is fully initialized
    eventBus.on("pagesinit", () => {
      // Restore last zoom
      let savedZoom = localStorage.getItem("lastZoom");
      if (savedZoom) {
        viewer.currentScaleValue = savedZoom;
        document.getElementById("zoomSelect").value = savedZoom;
      } else {
        viewer.currentScaleValue = window.innerWidth < 768 ? "page-width" : "auto";
      }

      document.getElementById("pageCount").textContent = "/" + pdfDoc.numPages;
      document.getElementById("pageInput").max = pdfDoc.numPages;

      // Restore last page
      let savedPage = parseInt(localStorage.getItem("lastPage"), 10);
      if (savedPage && savedPage > 0 && savedPage <= pdfDoc.numPages) {
        viewer.currentPageNumber = savedPage;
      }

      // Sync input with current page
      document.getElementById("pageInput").value = viewer.currentPageNumber;
    });

    // When page changes
    eventBus.on("pagechanging", (e) => {
      document.getElementById("pageInput").value = e.pageNumber;
      localStorage.setItem("lastPage", e.pageNumber);
    });

    async function openPDF(url) {
      const loadingTask = pdfjsLib.getDocument(url);
      pdfDoc = await loadingTask.promise;
      viewer.setDocument(pdfDoc);
      linkService.setDocument(pdfDoc, null);
    }

    // Load your PDF file
    openPDF("index.pdf");

    // Page input jump
    document.getElementById("pageInput").addEventListener("change", (e) => {
      let page = parseInt(e.target.value, 10);
      if (page > 0 && page <= pdfDoc.numPages) {
        viewer.currentPageNumber = page;
      } else {
        e.target.value = viewer.currentPageNumber;
      }
    });

    // Prev button
    document.getElementById("prevPage").addEventListener("click", () => {
      if (viewer.currentPageNumber > 1) {
        viewer.currentPageNumber -= 1;
      }
    });

    // Next button
    document.getElementById("nextPage").addEventListener("click", () => {
      if (viewer.currentPageNumber < pdfDoc.numPages) {
        viewer.currentPageNumber += 1;
      }
    });

    // Zoom control
    document.getElementById("zoomSelect").addEventListener("change", (e) => {
      viewer.currentScaleValue = e.target.value;
      localStorage.setItem("lastZoom", e.target.value);
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
      if (!pdfDoc) return;

      switch (e.key) {
        case "ArrowLeft": // Prev page
          if (viewer.currentPageNumber > 1) {
            viewer.currentPageNumber -= 1;
          }
          break;
        case "ArrowRight": // Next page
          if (viewer.currentPageNumber < pdfDoc.numPages) {
            viewer.currentPageNumber += 1;
          }
          break;
        case "+":
        case "=": { // Zoom in
          let newScale = viewer.currentScale + 0.25;
          if (newScale <= 3) {
            viewer.currentScale = newScale;
            localStorage.setItem("lastZoom", viewer.currentScale);
          }
          break;
        }
        case "-": { // Zoom out
          let newScale = viewer.currentScale - 0.25;
          if (newScale >= 0.5) {
            viewer.currentScale = newScale;
            localStorage.setItem("lastZoom", viewer.currentScale);
          }
          break;
        }
      }
    });
  </script>
</body>
</html>
